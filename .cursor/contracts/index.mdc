# .cursor/contracts Index

Work contracts -- session-independent execution plans with state, tasks, and completion criteria.

**Organization:** Directories reflect lifecycle status (`draft/`, `active/`, `completed/`). Urgency relative to the current goal is defined in `current-goal.mdc`. Read the goal manifest first to know what matters now.

---

## active/ -- Contracts being executed

(No active contracts.)

## draft/ -- Planned, not yet being executed

| Contract | Goal | Tier |
|----------|------|------|
| `principled-calibration-scorecard.md` | Replace arbitrary metric thresholds with ROI-grounded analysis; elevate calibration to Origami framework concern with declarative ScoreCard YAML. Spans Origami + Asterisk. | gate |
| `asterisk-internal-cleanup.md` | Merge remaining `internal/` packages (`orchestrate`, `calibrate`, `investigate`, `ingest`) into `adapters/`; complete pure-DSL migration. | should |
| `refine-rtfm-routing-policy.md` | Replace RTFM node with `ReadPolicy` on Origami `Source`; delete `internal/rtfm/`, inject always-read content into prompts. Spans Origami + Asterisk. | should |
| `data-ingestion-pipeline.md` | Data ingestion as DSL pipeline (`asterisk-ingest.yaml`). RP source adapter, symptom matching, dedup, candidate creation, human review via `consume run` + `dataset review/promote`. | should |
| `improve-asterisk-kabuki-demo.md` | Overhaul Kabuki demo: three-act narrative, War Room live view, grounded language, interactive graphs, responsive scaling. Spans Origami + Asterisk. | should |
| `evidence-gap-brief.md` | Structured "what's missing" output when pipeline confidence is low or inconclusive. | nice |
| `knowledge-source-evolution.md` | Layered composition via `Source.Tags`, artifact dependency graph, token-budget summarization. Long-term architecture. | vision |

## completed/ -- Historical record (Asterisk domain contracts; framework contracts moved to Origami)

Grouped by original development phase. All contracts below are **complete** (or closed).

### completed/mock/ (4)

| Contract | Goal |
|----------|------|
| `mock-pre-investigation.md` | Mock fetch + save envelope to store. |
| `mock-investigation.md` | Mock analyze: read from store, produce cases + artifact. |
| `mock-post-investigation.md` | Mock push: read artifact, write defect type + RCA. |
| `mock-wiring.md` | Wire fetch, analyze, push into one runnable flow. |

### completed/poc/ (11)

| Contract | Goal |
|----------|------|
| `rp-api-completion.md` | RP API research; document launch, test-item, defect-type. |
| `rp-api-research.md` | RP API deep research (5.11); endpoints, usage, example launch 33195. |
| `storage-adapter.md` | SQLite + Store facade (cases, RCAs); per-workspace DB. |
| `context-workspace.md` | Load workspace from FS (YAML/JSON); pass into analyze. |
| `artifact-schema.md` | Add `rca_message` to artifact; document schema. |
| `prompts.md` | Prompt templates in `.cursor/prompts/`; params doc. |
| `rp-fetch.md` | Real fetch from RP (launch by ID); produce envelope. |
| `rp-push.md` | Real push to RP (defect-type update from artifact). |
| `asterisk-cli.md` | `asterisk` binary with `analyze` and `push -f`. |
| `cursor-handoff.md` | Minimal `asterisk --cursor`; prompt output, save/ingest. |
| `pre-dev-questions.md` | Pre-development question bank; answers and deferrals. |

### completed/design/ (2)

| Contract | Goal |
|----------|------|
| `prompt-families.md` | Prompt family taxonomy (F0-F6), pipelines, loops, routing heuristics. |
| `investigation-context.md` | Two-tier data model: investigation tree + global knowledge. |

### completed/poc-v2/ (9)

| Contract | Goal |
|----------|------|
| `logging-standardization.md` | Standardize all logs on `log/slog` with per-module `component` attribute, level gating, and CLI flags. |
| `storage-adapter-v2.md` | Migrate Store to two-tier schema (execution tree + symptoms + RCAs). |
| `prompt-orchestrator.md` | F0-F6 pipeline engine: heuristics, artifact I/O, template filler, CLI. |
| `e2e-calibration.md` | Closed-world E2E test: 20 metrics, 3 scenarios, all stub-passing. |
| `phase-5a-mitigation.md` | Phase 5a mitigation umbrella: taxonomy translator, color-coded agents, workspace MVP, dataset expansion. All 9 tasks complete. |
| `workspace-mvp.md` | Wire RP launch attrs, Jira links, repo paths into prompts. Resolution status. M12/M13=0.00 → >0. 11 tasks, 5 tests. |
| `poc-scope-precision.md` | Zero-friction PoC packaging: simplified CLI, Cursor skill, CEO-ready README. 7 tasks complete. |
| `data-swipe.md` | Scrub internal infrastructure hostnames from git history. |
| `improve-human-operator-output.md` | Human narration during calibration: vocabulary, templates, ETA, position tags. |

### completed/pipeline/ (3)

| Contract | Goal |
|----------|------|
| `rp-adapter-v2.md` | Unified `internal/rp` package; scope-based client, APIError, context. |
| `cursor-skill.md` | `asterisk-investigate` Cursor skill; signal-based F0-F6 artifact production. |
| `wet-calibration.md` | Dry/wet calibration taxonomy, 28 Test Cards, victory loop. **Closed.** |

### completed/calibration/ (15)

| Contract | Goal |
|----------|------|
| `real-calibration-ingest.md` | Ingest real CI data into 30-case `ptp-real-ingest` scenario. |
| `calibration-bugfix-r5.md` | Fix 5 blocking bugs. M19: 0.58 to 0.65+. |
| `responder-classification-v2.md` | Scored multi-signal classifier. M19: 0.65 to 0.80+. |
| `calibration-victory.md` | Evidence quality, convergence calibration. M19: 0.80 to 0.95+. |
| `parallel-investigation.md` | Fan-out F0-F1, symptom clustering, 3x speedup. |
| `ground-truth-v2.md` | Correct scenario data to match Jira audit. |
| `true-wet-calibration.md` | Blind calibration against Jira-verified truth. M19 = 0.93 achieved. |
| `wet-calibration-tuning.md` | Lift CursorAdapter ptp-mock dry M19 from 0.49 to >= 0.65. **Complete** (M19=0.74→0.83). |
| `m3-m9-tuning.md` | Lift M3 (Recall Hit Rate) >= 0.70, M9 (Repo Selection Precision) >= 0.70. **Complete** (M3=0.83, M9=1.00). |
| `efficiency-m16-m17-m18-tuning.md` | Lift M16 >= 0.60, M17 in [0.5,2.0], M18 <= 60000. **Complete** (M16=0.67, M17=1.00, M18=55609). |
| `m9-m10-four-pain-points.md` | Lift M9 >= 0.70, M10 >= 0.80 via deterministic hypothesis-based repo routing. **Complete** (M9=1.00, M10=1.00). |
| `asterisk-papercup-v2-hardening.md` | Embed Papercup v2 choreography into Asterisk MCP server: server-generated worker prompt, inline prompt content, mode tracking, v2 supervisor skill. Companion: `origami-papercup-v2-hardening` in Origami repo. |
| `marshaller-step-schema-factory.md` | Enrich Asterisk step schemas with `FieldDef` entries for runtime validation; update calibrate skill for `submit_step`. Companion: Origami `marshaller-step-schema-factory`. |
| `calibration-primitives-consumer.md` | Import generic calibration types from `origami/calibrate`; type aliases, embedded report, `cal.AggregateRunMetrics`, `cal.FormatReport`. Companion: Origami `calibration-primitives`. |
| `asterisk-calibrate-skill.md` | `asterisk-calibrate` Cursor Skill (v2 choreography, MCP-based, 4 parallel workers). **Complete.** |
| `domain-cursor-prompt-tuning.md` | CursorAdapter prompt tuning. **Abandoned** — superseded by `phase-5a-v2-analysis`. |
| `poc-tuning-loop.md` | BasicAdapter tuning quick wins. **Abandoned** — QW-1/2 done by workspace-mvp, QW-3 absorbed by phase-5a-v2-analysis. |
| `phase-5a-v2-analysis.md` | CursorAdapter M19 analysis + mitigation. Baseline established at 0.58. Root causes documented. PoC proved. |
| `rp-e2e-launch.md` | Real blind E2E calibration. BasicAdapter M19=0.83. CursorAdapter M19=0.58. Final PoC gate. |

### completed/distillation/ (2)

| Contract | Goal |
|----------|------|
| `asterisk-origami-distillation.md` | Validate framework boundary by classifying every package and building Achilles as a second Origami tool with zero domain imports. |
| `distillation-endgame.md` | Migrate remaining framework packages from Asterisk to Origami; build artifact schemas, exec engine, generic dispatch. |

### Moved to Origami

The following completed contract groups were moved to `github.com/dpopsuev/origami/.cursor/contracts/completed/`:
- **framework/** (14 contracts) — Tomes I-IV: ontology, DSL, elements, cycles, personas, masks, adversarial dialectic, Ouroboros (metacalibration), discovery.
- **mcp/** (5 contracts) — MCP server, pipeline tools, calibration mode, underload decouple, Ouroboros server.
- **multi-subagent/** (4 contracts) — batch dispatch, adaptive scheduler, multi-subagent skill.
- Cherry-picks from pipeline/ (fs-dispatcher, cleanup-lifecycle) and poc-v2/ (concurrent-subagents, subagent-testing).

### completed/architecture/ (7)

| Contract | Goal |
|----------|------|
| `calibrate-decomposition.md` | Split `calibrate` into `dispatch/`, `adapt/` sub-packages. |
| `cobra-cli.md` | Cobra CLI migration; subcommands, help, shell completion. |
| `critical-test-coverage.md` | Close 8 test gaps; 80%+ critical, 70%+ high, 60%+ medium. |
| `concurrency-modernization.md` | errgroup + context.Context propagation; eliminate mutable globals. |
| `deadcode-dedup-architecture.md` | Remove dead code, catalog deduplication candidates, produce boundary map. Stale framework files deleted. |
| `rename-origami-to-dataset.md` | Rename `internal/origami/` to `internal/dataset/`. Mechanical rename, no behavior changes. |
| `investigate-pipeline-artifact-store.md` | Investigated `internal/store/`: v1 alive (5 callers), no generic extraction, no interface split needed. Investigation-only. |

### completed/knowledge-store/ (3)

| Contract | Goal |
|----------|------|
| `fsc-knowledge-compartmentalization.md` | 4-compartment knowledge store (universal, domain, personal, sensitive); tiered rule routing (11 → 3 alwaysApply). |
| `architecture-snapshots.md` | Architecture diagrams as first-class artifacts; current/desired state snapshots; retrofit 3 contracts; extend `docs/architecture.md`. |
| `soul-red-hat-telco.md` | Red Hat identity, telco mission, OSS philosophy, and scale awareness encoded into strategy, invariants, and standards. |


### completed/presentation/ (1)

| Contract | Goal |
|----------|------|
| `demo-presentation.md` | Police Station KabukiConfig + Theme, `asterisk demo` CLI, integration tests. Phase 3 (canonical recording) deferred. |

### completed/output/ (6)

| Contract | Goal |
|----------|------|
| `human-readable-output.md` | Replace machine codes with human-readable names; `internal/display` registry. |
| `unified-formatter.md` | `go-pretty/v6` adapter; `internal/format` with ASCII + Markdown modes. |
| `token-perf-tracking.md` | Instrument real token usage; compute cost; upgrade M18. |
| `tokimeter.md` | Markdown-formatted cost bill per case/step/total. |
| `transcript-weaver.md` | Post-hoc Markdown transcript per Root Cause; flag-gated, adapter-agnostic. |
| `go-testing-preferences.md` | Go testing: stdlib vs Ginkgo; rules in `rules/go-test-conventions.mdc`. |

### completed/absorbed/ (2)

| Contract | Goal |
|----------|------|
| `ground-truth-dataset.md` | Grow dataset to 50+. Phases 1-2 done. Absorbed by `data-ingestion-pipeline` + `consumer-cli-scaffold`. |
| `knowledge-source-migration.md` | Migrate to `knowledge` types. Phase 1 done. Absorbed by `refine-rtfm-routing-policy` + `knowledge-source-evolution`. |

---

## Directories

- `active/` -- Contracts currently being executed.
- `draft/` -- Planned contracts not yet being executed.
- `completed/` -- Finished contracts grouped by original development phase.

## Files (root)

- `current-goal.mdc` — Goal manifest: declares active goal and urgency map for all non-completed contracts.
- `_TEMPLATE.md` -- Contract template; copy to create new contracts.
