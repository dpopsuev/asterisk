---
description: Symptoms layer — in PoC as local intermediate table; concurrency and service coordination are future
---

# Symptoms model: PoC scope vs. future service scope

## PoC scope (in scope now)

The symptoms layer is an **intermediate table** between Case and RCA that allows faster work and querying. Included in the PoC as a local, single-agent concept.

```
Case ──reports──▶ Symptom ──caused by──▶ RCA
 (witness)         (story)    (via SymptomRCA)   (criminal)
```

- **Symptoms table** — recognized failure patterns identified by fingerprint. Cross-version institutional memory. Enables F0 Recall (have we seen this before?), F1 Triage (is this recurring?), F4 Correlate (serial killer detection).
- **SymptomRCA junction** — many-to-many knowledge graph linking symptoms to root causes.
- **Fingerprint matching** — deterministic hash for fast symptom lookup.
- **Staleness rules** — dormant/active/resolved temporal status for symptoms.
- All local, single-agent, SQLite-backed. No concurrency concerns in PoC.

See `contracts/investigation-context.md` and `docs/cli-data-model.mdc` for full entity definitions.

## Future scope (not in PoC)

When Asterik becomes a **service** handling **concurrency of several agents**:

### Concurrency (open questions)

- When multiple agents run in parallel: should we **wait** for others to finish so we don't create duplicate symptom entries? Or allow duplicates and merge/dedup later?
- Other edge cases: locking, visibility of in-progress symptoms, conflict resolution when two agents assign the same symptom to different RCAs.
- Revisit when designing the service and multi-agent concurrency.

### Coordination via pub-sub and message queue (idea)

- Introduce a **pub-sub bus** and a **message queue**.
- **Investigator service** (or each agent) **reads from the queue after completing symptom assessments** so it does **not miss results from other investigators**.
- Flow: agents publish symptom-assessment results to the bus; the investigator service subscribes and consumes from the queue, then continues with root-cause investigation using the full set of symptom data (its own + others').
- Open: queue semantics (at-least-once, ordering), dedup, who writes to the symptoms table (publisher vs consumer), barrier signaling.

## References

- Data model: `docs/cli-data-model.mdc`, `contracts/investigation-context.md`.
- Service/MVP: `goals/poc.mdc`; `notes/poc-constraints.mdc`.
