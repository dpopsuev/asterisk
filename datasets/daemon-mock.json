{
  "name": "daemon-mock",
  "description": "Daemon Process Management: 2 RCAs (broken pipe + config hang), 3 symptoms, 8 cases",
  "rcas": [
    {
      "id": "R1",
      "title": "Broken pipe: daemon→proxy events.sock communication buffer clog",
      "description": "The linuxptp-daemon writes PTP events to cloud-event-proxy via a Unix socket (/cloud-native/events.sock). Under burst conditions the pipe buffer clogs, causing EPIPE on write. Concatenated burst at receiver corrupts event stream.",
      "defect_type": "pb001",
      "category": "product",
      "component": "linuxptp-daemon",
      "affected_versions": [
        "4.18",
        "4.19"
      ],
      "jira_id": "OCPBUGS-74895",
      "required_keywords": [
        "broken",
        "pipe",
        "events.sock",
        "socket",
        "buffer",
        "EPIPE"
      ],
      "keyword_threshold": 3,
      "relevant_repos": [
        "linuxptp-daemon",
        "cloud-event-proxy",
        "cnf-gotests"
      ],
      "verified": false
    },
    {
      "id": "R2",
      "title": "Config change hang: daemon stops children services, doesn't restart them",
      "description": "When a PTP config change is detected, the linuxptp-daemon kills child processes (ptp4l, phc2sys) but fails to restart them. The daemon enters a stuck state where no PTP synchronization occurs.",
      "defect_type": "pb001",
      "category": "product",
      "component": "linuxptp-daemon",
      "affected_versions": [
        "4.18",
        "4.19"
      ],
      "jira_id": "OCPBUGS-74904",
      "required_keywords": [
        "config",
        "hang",
        "restart",
        "children",
        "ptp4l",
        "phc2sys",
        "kill"
      ],
      "keyword_threshold": 3,
      "relevant_repos": [
        "linuxptp-daemon"
      ],
      "verified": false
    }
  ],
  "symptoms": [
    {
      "id": "S1",
      "name": "Config change hang — process restart failure",
      "error_pattern": "ptp4l.*process.*kill.*daemon.*restart|phc2sys.*PANIC.*recovery",
      "component": "linuxptp-daemon",
      "maps_to_rca": "R2"
    },
    {
      "id": "S2",
      "name": "Broken pipe — event socket write failure",
      "error_pattern": "events\\.sock.*broken pipe|EPIPE.*cloud-event-proxy",
      "component": "linuxptp-daemon",
      "maps_to_rca": "R1"
    },
    {
      "id": "S3",
      "name": "BeforeEach cascade — 2-port OC setup fails",
      "error_pattern": "BeforeEach.*ptp_interfaces\\.go:498.*2-port.*setup",
      "component": "cnf-gotests",
      "maps_to_rca": "R1"
    }
  ],
  "cases": [
    {
      "id": "C1",
      "version": "4.18",
      "job": "[recovery]",
      "test_name": "PTP Recovery \u003e ptp process restart \u003e should recover phc2sys after killing it",
      "error_message": "ptp4l[8901]: process killed by daemon config change; daemon failed to restart phc2sys within 30s",
      "log_snippet": "2026-01-15T10:00:00Z daemon: PTP config change detected, stopping children\n2026-01-15T10:00:01Z daemon: killed phc2sys (pid 4321)\n2026-01-15T10:00:31Z FAIL: ptp4l process killed by daemon config change; daemon failed to restart phc2sys within 30s\nFAIL: Expected phc2sys to be running after config change",
      "symptom_id": "S1",
      "rca_id": "R2",
      "expected_path": [
        "F0",
        "F1",
        "F2",
        "F3",
        "F4",
        "F5",
        "F6"
      ],
      "expected_recall": {
        "match": false,
        "confidence": 0
      },
      "expected_triage": {
        "symptom_category": "product",
        "severity": "critical",
        "defect_type_hypothesis": "pb001",
        "candidate_repos": [
          "linuxptp-daemon",
          "ptp-operator"
        ],
        "skip_investigation": false,
        "cascade_suspected": false
      },
      "expected_resolve": {
        "selected_repos": [
          {
            "name": "linuxptp-daemon",
            "reason": "SUT daemon with config change handling"
          }
        ]
      },
      "expected_invest": {
        "rca_message": "Config change handler in linuxptp-daemon kills child processes (ptp4l, phc2sys) but fails to restart them. The daemon enters a stuck state after config change detection.",
        "defect_type": "pb001",
        "component": "linuxptp-daemon",
        "convergence_score": 0.85,
        "evidence_refs": [
          "linuxptp-daemon:pkg/daemon/process.go:config_change"
        ]
      },
      "expected_correlate": {
        "is_duplicate": false,
        "confidence": 0.3,
        "cross_version_match": false
      },
      "expected_review": {
        "decision": "approve"
      },
      "expect_recall_hit": false,
      "expect_skip": false,
      "expect_cascade": false,
      "expected_loops": 0
    },
    {
      "id": "C2",
      "version": "4.18",
      "job": "[recovery]",
      "test_name": "PTP Recovery \u003e ptp process restart \u003e should recover ptp4l after killing it",
      "error_message": "PANIC: ptp4l process recovery failed — daemon stuck in kill loop [recovered]\npanic.go:115",
      "log_snippet": "2026-01-15T10:30:00Z daemon: PTP config change detected\n2026-01-15T10:30:01Z PANIC: ptp4l process recovery failed — daemon stuck in kill loop\npanic.go:115\n[recovered]",
      "symptom_id": "S1",
      "rca_id": "R2",
      "expected_path": [
        "F0",
        "F5",
        "F6"
      ],
      "expected_recall": {
        "match": true,
        "confidence": 0.95
      },
      "expected_review": {
        "decision": "approve"
      },
      "expect_recall_hit": true,
      "expect_skip": false,
      "expect_cascade": false,
      "expected_loops": 0
    },
    {
      "id": "C3",
      "version": "4.18",
      "job": "[events]",
      "test_name": "PTP Recovery \u003e HTTP events \u003e validates system after removing consumer",
      "error_message": "[AfterEach] ptp_events_and_metrics.go:175: daemon failed to restart ptp4l after consumer removal",
      "log_snippet": "2026-01-15T11:00:00Z [AfterEach] cleanup: removing event consumer\n2026-01-15T11:00:01Z daemon: config change triggered by consumer removal\n2026-01-15T11:00:31Z FAIL [AfterEach]: daemon failed to restart ptp4l after consumer removal",
      "symptom_id": "S1",
      "rca_id": "R2",
      "expected_path": [
        "F0",
        "F5",
        "F6"
      ],
      "expected_recall": {
        "match": true,
        "confidence": 0.92
      },
      "expected_review": {
        "decision": "approve"
      },
      "expect_recall_hit": true,
      "expect_skip": false,
      "expect_cascade": false,
      "expected_loops": 0
    },
    {
      "id": "C4",
      "version": "4.18",
      "job": "[recovery]",
      "test_name": "PTP Recovery \u003e ptp node reboot \u003e validates PTP consumer events after reboot",
      "error_message": "events.sock: broken pipe writing PTP event after node reboot; consumer events lost",
      "log_snippet": "2026-01-15T12:00:00Z daemon: node reboot detected, reinitializing PTP\n2026-01-15T12:00:05Z write /cloud-native/events.sock: broken pipe (EPIPE)\n2026-01-15T12:00:06Z cloud-event-proxy: consumer events lost after pipe break\nFAIL: Expected PTP consumer events to resume after reboot",
      "symptom_id": "S2",
      "rca_id": "R1",
      "expected_path": [
        "F0",
        "F1",
        "F2",
        "F3",
        "F4",
        "F5",
        "F6"
      ],
      "expected_recall": {
        "match": false,
        "confidence": 0
      },
      "expected_triage": {
        "symptom_category": "product",
        "severity": "critical",
        "defect_type_hypothesis": "pb001",
        "candidate_repos": [
          "linuxptp-daemon",
          "cloud-event-proxy"
        ],
        "skip_investigation": false,
        "cascade_suspected": false
      },
      "expected_resolve": {
        "selected_repos": [
          {
            "name": "linuxptp-daemon",
            "reason": "Daemon writes to events.sock"
          },
          {
            "name": "cloud-event-proxy",
            "reason": "Proxy reads from events.sock"
          }
        ]
      },
      "expected_invest": {
        "rca_message": "Broken pipe on Unix socket /cloud-native/events.sock. The linuxptp-daemon writes PTP events to cloud-event-proxy via this socket. Under burst (e.g. after node reboot), the pipe buffer clogs causing EPIPE. Events are lost or corrupted at the receiver.",
        "defect_type": "pb001",
        "component": "linuxptp-daemon",
        "convergence_score": 0.8,
        "evidence_refs": [
          "linuxptp-daemon:pkg/event/socket.go:write_event",
          "cloud-event-proxy:pkg/receiver/handler.go:pipe_read"
        ]
      },
      "expected_correlate": {
        "is_duplicate": false,
        "confidence": 0.35,
        "cross_version_match": false
      },
      "expected_review": {
        "decision": "approve"
      },
      "expect_recall_hit": false,
      "expect_skip": false,
      "expect_cascade": false,
      "expected_loops": 0
    },
    {
      "id": "C5",
      "version": "4.18",
      "job": "[events]",
      "test_name": "PTP Events \u003e interface down \u003e should generate events when slave interface goes down",
      "error_message": "events.sock: broken pipe writing PTP event after interface down; consumer events lost",
      "log_snippet": "2026-01-15T13:00:00Z PTP: slave interface ens3f0 went down\n2026-01-15T13:00:01Z write /cloud-native/events.sock: broken pipe (EPIPE)\nFAIL: Expected PTP events after interface down/up cycle",
      "symptom_id": "S2",
      "rca_id": "R1",
      "expected_path": [
        "F0",
        "F5",
        "F6"
      ],
      "expected_recall": {
        "match": true,
        "confidence": 0.93
      },
      "expected_review": {
        "decision": "approve"
      },
      "expect_recall_hit": true,
      "expect_skip": false,
      "expect_cascade": false,
      "expected_loops": 0
    },
    {
      "id": "C6",
      "version": "4.18",
      "job": "[events]",
      "test_name": "PTP Events \u003e interface down OC 2 port \u003e verifies 2-port oc ha failover",
      "error_message": "[BeforeEach] ptp_interfaces.go:498: failed to setup 2-port OC profile: events.sock: broken pipe during initialization",
      "log_snippet": "2026-01-15T14:00:00Z [BeforeEach] ptp_interfaces.go:498: setting up 2-port OC profile\n2026-01-15T14:00:01Z events.sock: broken pipe during OC initialization\nFAIL [BeforeEach]: failed to setup 2-port OC profile",
      "symptom_id": "S3",
      "rca_id": "R1",
      "expected_path": [
        "F0",
        "F1",
        "F3",
        "F4"
      ],
      "expected_recall": {
        "match": false,
        "confidence": 0.15
      },
      "expected_triage": {
        "symptom_category": "product",
        "severity": "high",
        "defect_type_hypothesis": "pb001",
        "candidate_repos": [
          "cnf-gotests"
        ],
        "skip_investigation": false,
        "cascade_suspected": true
      },
      "expected_invest": {
        "rca_message": "Cascade from broken pipe. BeforeEach at ptp_interfaces.go:498 fails because the events.sock pipe is broken during OC profile initialization. Same root cause as the node reboot pipe failure.",
        "defect_type": "pb001",
        "component": "linuxptp-daemon",
        "convergence_score": 0.82,
        "evidence_refs": [
          "cnf-gotests:test/ptp_interfaces.go:498"
        ]
      },
      "expected_correlate": {
        "is_duplicate": true,
        "confidence": 0.88,
        "cross_version_match": false
      },
      "expected_review": {
        "decision": "approve"
      },
      "expect_recall_hit": false,
      "expect_skip": false,
      "expect_cascade": true,
      "expected_loops": 0
    },
    {
      "id": "C7",
      "version": "4.18",
      "job": "[events]",
      "test_name": "PTP Events \u003e interface down OC 2 port \u003e verifies 2-port oc ha holdover and freerun",
      "error_message": "[BeforeEach] ptp_interfaces.go:498: failed to setup 2-port OC profile: events.sock: broken pipe during initialization",
      "log_snippet": "2026-01-15T14:00:02Z [BeforeEach] ptp_interfaces.go:498: failed to setup 2-port OC profile\nFAIL [BeforeEach]: same BeforeEach cascade",
      "symptom_id": "S3",
      "rca_id": "R1",
      "expected_path": [
        "F0",
        "F5",
        "F6"
      ],
      "expected_recall": {
        "match": true,
        "confidence": 0.92
      },
      "expected_review": {
        "decision": "approve"
      },
      "expect_recall_hit": true,
      "expect_skip": false,
      "expect_cascade": false,
      "expected_loops": 0
    },
    {
      "id": "C8",
      "version": "4.18",
      "job": "[events]",
      "test_name": "PTP Events \u003e interface down OC 2 port \u003e verifies 2-port oc ha passive interface recovery",
      "error_message": "[BeforeEach] ptp_interfaces.go:498: failed to setup 2-port OC profile: events.sock: broken pipe during initialization",
      "log_snippet": "2026-01-15T14:00:03Z [BeforeEach] ptp_interfaces.go:498: failed to setup 2-port OC profile\nFAIL [BeforeEach]: same BeforeEach cascade",
      "symptom_id": "S3",
      "rca_id": "R1",
      "expected_path": [
        "F0",
        "F5",
        "F6"
      ],
      "expected_recall": {
        "match": true,
        "confidence": 0.92
      },
      "expected_review": {
        "decision": "approve"
      },
      "expect_recall_hit": true,
      "expect_skip": false,
      "expect_cascade": false,
      "expected_loops": 0
    }
  ],
  "workspace": {
    "repos": [
      {
        "name": "linuxptp-daemon",
        "path": "",
        "purpose": "SUT: PTP daemon running on nodes — ptp4l, phc2sys, ts2phc processes; event socket communication with cloud-event-proxy",
        "branch": "release-4.18",
        "relevant_to_rcas": [
          "R1",
          "R2"
        ]
      },
      {
        "name": "cloud-event-proxy",
        "path": "",
        "purpose": "Cloud Event Proxy: receives PTP events from daemon via Unix socket (/cloud-native/events.sock); publishes cloud events",
        "branch": "release-4.18",
        "relevant_to_rcas": [
          "R1"
        ]
      },
      {
        "name": "cnf-gotests",
        "path": "",
        "purpose": "PTP test cases (Ginkgo): test code, assertions, test helpers. Error stacks point here for cascade failures.",
        "branch": "master",
        "relevant_to_rcas": [
          "R1"
        ]
      },
      {
        "name": "ptp-operator",
        "path": "",
        "purpose": "PTP operator lifecycle: manages linuxptp-daemon DaemonSet, PtpConfig CRD, PTP profiles",
        "branch": "release-4.18"
      },
      {
        "name": "eco-gotests",
        "path": "",
        "purpose": "Ecosystem QE test framework; shared helpers used by other test suites (NOT PTP-specific)",
        "branch": "master",
        "is_red_herring": true
      }
    ]
  },
  "dry_capped_metrics": [
    "M12",
    "M13"
  ]
}